{% extends "base.html" %}

{% block title %}Register - Business Management System{% endblock %}

{% block content %}
<div class="flex min-h-screen">
    <div class="flex flex-1 flex-col justify-center px-4 py-12 sm:px-6 lg:flex-none lg:px-20 xl:px-24">
        <div class="mx-auto w-full max-w-sm lg:w-96">
            <div>
                <a href="/" class="text-2xl font-bold text-indigo-600">
                    <i class="fas fa-briefcase mr-2"></i>BMS
                </a>
                <h2 class="mt-8 text-2xl font-bold leading-9 tracking-tight text-gray-900">
                    Create your account
                </h2>
                <p class="mt-2 text-sm leading-6 text-gray-500">
                    Already have an account?
                    <a href="/login" class="font-semibold text-indigo-600 hover:text-indigo-500">
                        Sign in
                    </a>
                </p>
            </div>

            <div class="mt-10">
                <form id="register-form" class="space-y-6">
                    <div>
                        <label for="username" class="block text-sm font-medium leading-6 text-gray-900">
                            Username
                        </label>
                        <div class="mt-2">
                            <input id="username" name="username" type="text" required
                                   class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        </div>
                    </div>

                    <div>
                        <label for="email" class="block text-sm font-medium leading-6 text-gray-900">
                            Email address
                        </label>
                        <div class="mt-2">
                            <input id="email" name="email" type="email" autocomplete="email" required
                                   class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        </div>
                    </div>

                    <div>
                        <label for="password" class="block text-sm font-medium leading-6 text-gray-900">
                            Password
                        </label>
                        <div class="mt-2">
                            <input id="password" name="password" type="password" autocomplete="new-password" required
                                   class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        </div>
                        <p class="mt-1 text-xs text-gray-500">Must be at least 8 characters</p>
                    </div>

                    <div>
                        <label for="confirm-password" class="block text-sm font-medium leading-6 text-gray-900">
                            Confirm Password
                        </label>
                        <div class="mt-2">
                            <input id="confirm-password" name="confirm-password" type="password" required
                                   class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        </div>
                    </div>

                    <div>
                        <button type="submit" id="submit-btn"
                                class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 transition">
                            Create Account
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="relative hidden w-0 flex-1 lg:block">
        <div class="absolute inset-0 bg-gradient-to-br from-purple-600 to-indigo-700"></div>
        <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAxMCAwIEwgMCAwIDAgMTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1vcGFjaXR5PSIwLjEiIHN0cm9rZS13aWR0aD0iMSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNncmlkKSIvPjwvc3ZnPg==')] opacity-20"></div>
        <div class="relative flex h-full flex-col items-center justify-center p-12 text-white">
            <div class="max-w-md text-center">
                <i class="fas fa-rocket text-6xl mb-6 opacity-90"></i>
                <h3 class="text-3xl font-bold mb-4">Join Us Today!</h3>
                <p class="text-lg opacity-90 mb-6">
                    Start managing your business more efficiently with our comprehensive platform.
                </p>
                <ul class="text-left space-y-3">
                    <li class="flex items-start">
                        <i class="fas fa-check-circle mr-3 mt-1"></i>
                        <span>Unlimited team members</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle mr-3 mt-1"></i>
                        <span>Advanced task management</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle mr-3 mt-1"></i>
                        <span>Meeting scheduling & calendar</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    const form = document.getElementById('register-form');
    const submitBtn = document.getElementById('submit-btn');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm-password').value;

        if (password !== confirmPassword) {
            showFlash('Passwords do not match', 'error');
            return;
        }

        if (password.length < 8) {
            showFlash('Password must be at least 8 characters', 'error');
            return;
        }

        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating account...';

        try {
            const response = await fetch('{{ api_url }}/v1/auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username, email, password })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || 'Registration failed');
            }

            showFlash('Account created successfully! Redirecting to login...', 'success');
            setTimeout(() => {
                window.location.href = '/login';
            }, 1500);

        } catch (error) {
            showFlash(error.message, 'error');
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Create Account';
        }
    });

    if (getToken()) {
        window.location.href = '/dashboard';
    }
</script>
{% endblock %}